# 平衡权重DANP算法 (Balanced DANP)

## 概述
这是对原始DANP算法的改进版本，解决了因维度内因素个数不平衡导致的权重偏差问题。

## 问题背景
在原始DANP算法中，当各维度包含的因素个数差异较大时，会出现以下问题：
- 包含因素较少的维度，每个因素获得较高权重
- 包含因素较多的维度，每个因素权重被稀释
- 导致整体权重分配不公平

## 解决方案
采用**维度权重平衡方法**：

### 1. 维度权重计算
```
维度权重 = 该维度因素个数 / 总因素个数
```

### 2. 因素权重调整
```
平衡权重 = (因素在维度内的相对权重) × (维度权重)
```

### 3. 实际案例
基于测试数据（4个维度，分布为2,5,3,1）：

**维度权重分配：**
- 维度1 (d1): 2个因素 → 18.2%权重
- 维度2 (d2): 5个因素 → 45.5%权重  
- 维度3 (d3): 3个因素 → 27.3%权重
- 维度4 (d4): 1个因素 → 9.1%权重

**权重调整效果：**
- c11: 0.128903 → 0.085557 (-33.6%)
- c12: 0.145031 → 0.096261 (-33.6%)
- c21: 0.078923 → 0.113560 (+43.9%)
- c22: 0.065705 → 0.094542 (+43.9%)
- c23: 0.054372 → 0.078235 (+43.9%)
- c24: 0.062178 → 0.089467 (+43.9%)
- c25: 0.054725 → 0.078742 (+43.9%)
- c31: 0.112000 → 0.085371 (-23.8%)
- c32: 0.123207 → 0.093913 (-23.8%)
- c33: 0.122591 → 0.093444 (-23.8%)
- c41: 0.052367 → 0.090909 (+73.6%)

## 算法改进要点

### 1. 保持原算法结构
- DEMATEL阶段完全不变
- ANP超矩阵计算过程不变
- 仅在最终权重分配时应用平衡调整

### 2. 数学公式
原始最终权重：
```
W_original = defuzzify(limit_weighted_matrix)
```

平衡最终权重：
```
W_balanced_i = (W_original_i / Σ(W_original_dim)) × Dimension_Weight_dim
```

其中：
- W_balanced_i: 因素i的平衡权重
- W_original_i: 因素i的原始权重  
- W_original_dim: 因素i所在维度的原始权重总和
- Dimension_Weight_dim: 因素i所在维度的目标权重

### 3. 输出文件
算法生成以下关键文件：
- `defuzzy_lim_weighted_original.xlsx`: 原始权重
- `defuzzy_lim_weighted_balanced.xlsx`: 平衡后权重
- `dimension_weights_distribution.xlsx`: 维度权重分配
- `weight_comparison.xlsx`: 权重对比详情
- `defuzzy_lim_weighted.xlsx`: 最终输出（平衡权重）

## 使用方法

### 1. 运行算法
```bash
cd balanced_danp
python main_danp.py
```

### 2. 输入参数
按提示输入：
- 专家人数
- 维度数量
- 各维度包含的因素数量

### 3. 查看结果
结果保存在 `result/时间戳/` 目录下，重点关注：
- 权重对比表 (`weight_comparison.xlsx`)
- 维度权重分配 (`dimension_weights_distribution.xlsx`)

## 算法优势

### 1. 消除结构性偏差
- 确保每个维度获得与其包含因素数量成比例的总权重
- 避免因结构不平衡导致的权重偏差

### 2. 保持决策逻辑
- 维度内因素的相对重要性关系保持不变
- 仅调整跨维度的权重分配比例

### 3. 提高公平性
- 大维度不再被过度稀释
- 小维度不再被过度放大
- 单因素维度获得合理的基础权重

### 4. 便于解释
- 维度权重分配逻辑清晰
- 权重调整过程透明
- 结果更符合直觉

## 适用场景

### 1. 理想应用场景
- 各维度因素数量差异较大（如2,5,3,1的分布）
- 希望维度间权重相对平衡
- 需要公平考虑所有维度的重要性

### 2. 注意事项
- 如果各维度因素数量相近，改进效果不明显
- 需要结合具体问题背景判断是否适用维度平衡逻辑
- 建议同时分析原始权重和平衡权重，根据实际需求选择

## 技术实现

### 1. 代码修改
主要修改在 `main_danp.py` 的最后部分，增加了：
- 维度权重计算逻辑
- 权重重新分配算法
- 对比分析和输出功能

### 2. 向后兼容
- 保留所有原始输出文件
- 增加新的分析文件
- 不影响现有工作流程

### 3. 验证机制
- 权重总和保持为1
- 提供详细的前后对比
- 计算相对变化百分比

这个改进版本有效解决了原始DANP算法的结构性偏差问题，使权重分配更加公平合理。 